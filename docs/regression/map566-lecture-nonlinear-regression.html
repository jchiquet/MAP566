<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.3.32">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>MAP566 - Stats in Action - Nonlinear Regression</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../../">
  <script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../../docs/regression/map566-lab-polynomial-regression.html" rel="next">
  <link href="../../docs/regression/map566-lecture-polynomial-regression.html" rel="prev">
  <script src="../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="docked">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <img src="../../logo_X.jpg" alt="">
    <span class="navbar-title">MAP566 - Stats in Action</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../getting-started.html">Getting Started</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jchiquet/MAP566"><i class="bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hypothesis-testing" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hypothesis Testing</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-hypothesis-testing">    
        <li class="dropdown-header">Lectures</li>
        <li>
    <a class="dropdown-item" href="../../docs/tests/map566-lecture-single.html">Statistical Tests</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/tests/map566-lecture-multiple.html">Multiple Testing</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Exercices</li>
        <li>
    <a class="dropdown-item" href="../../docs/tests/map566-lab-tests.html">Hypothesis Tesing</a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-regression-models" role="button" data-bs-toggle="dropdown" aria-expanded="false">Regression models</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-regression-models">    
        <li class="dropdown-header">Lectures</li>
        <li>
    <a class="dropdown-item" href="../../docs/regression/map566-lecture-polynomial-regression.html">Polynomial Regression</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/regression/map566-lecture-nonlinear-regression.html">Nonlinear Regression</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Exercices</li>
        <li>
    <a class="dropdown-item" href="../../docs/regression/map566-lab-polynomial-regression.html">Polynomial Regression</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/regression/map566-lab-nonlinear-regression.html">Nonlinear Regression</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Supplementary material</li>
        <li>
    <a class="dropdown-item" href="../../docs/regression/map566-lecture-regression-background.html">Linear Regression: Quick Recap</a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mixed-models" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mixed models</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-mixed-models">    
        <li class="dropdown-header">Lectures</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixed-models/map566-lecture-linear-mixed-model.html">Linear Mixed Effects Models</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/mixed-models/map566-lecture-nonlinear-mixed-model.html">Nonlinear Mixed Effects Models</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Exercices</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixed-models/map566-lab-linear-mixed-model.html">Linear Mixed Models</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/mixed-models/map566-lab-nonlinear-mixed-model.html">Nonlinear Mixed Effects Models</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Supplementary material</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixed-models/map566-lecture-EM-linear-mixed-model.html">An EM Algorithm for Linear Mixed Effects Models</a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-mixture-models" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mixture models</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-mixture-models">    
        <li class="dropdown-header">Lectures</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixture-models/map566-lecture-mixture-models.html">Mixture Models</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/mixture-models/map566-lecture-stochastic-blockmodels.html">Graph clustering</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Exercices</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixture-models/map566-lab-mixture-models.html">Mixture Models</a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/mixture-models/map566-lab-stochastic-blockmodels.html">Graph Clustering: Spectral methods and Stochastic Blockmodels</a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Supplementary material</li>
        <li>
    <a class="dropdown-item" href="../../docs/mixture-models/map566-doc-mixture-models-example.html">Mixture Models: an example</a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false">Homework</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-homework">    
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Nonlinear Regression</h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-lectures" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Lectures</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-lectures">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../docs/regression/map566-lecture-polynomial-regression.html" class="">Polynomial Regression</a>
</li>
          <li class="sidebar-item">
  <a href="../../docs/regression/map566-lecture-nonlinear-regression.html" class="active">Nonlinear Regression</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-exercices" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Exercices</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-exercices">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../docs/regression/map566-lab-polynomial-regression.html" class="">Polynomial Regression</a>
</li>
          <li class="sidebar-item">
  <a href="../../docs/regression/map566-lab-nonlinear-regression.html" class="">Nonlinear Regression</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-supplementary-material" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Supplementary material</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-supplementary-material">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../../docs/regression/map566-lecture-regression-background.html" class="">Linear Regression: Quick Recap</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
      <nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#preliminary" class="nav-link active" data-scroll-target="#preliminary">Preliminary</a></li>
<li><a href="#introduction" class="nav-link" data-scroll-target="#introduction"> <span class="header-section-number">1</span> Introduction</a></li>
<li><a href="#fitting-a-nonlinear-model" class="nav-link" data-scroll-target="#fitting-a-nonlinear-model"> <span class="header-section-number">2</span> Fitting a nonlinear model</a>
<ul class="collapse">
<li><a href="#estimation-of-the-parameters-of-the-model" class="nav-link" data-scroll-target="#estimation-of-the-parameters-of-the-model"> <span class="header-section-number">2.1</span> Estimation of the parameters of the model</a></li>
<li><a href="#standard-errors-of-the-parameter-estimates" class="nav-link" data-scroll-target="#standard-errors-of-the-parameter-estimates"> <span class="header-section-number">2.2</span> Standard errors of the parameter estimates</a></li>
<li><a href="#statistical-tests-for-the-model-parameters" class="nav-link" data-scroll-target="#statistical-tests-for-the-model-parameters"> <span class="header-section-number">2.3</span> Statistical tests for the model parameters</a></li>
<li><a href="#confidence-intervals-for-the-model-parameters" class="nav-link" data-scroll-target="#confidence-intervals-for-the-model-parameters"> <span class="header-section-number">2.4</span> Confidence intervals for the model parameters</a></li>
</ul></li>
<li><a href="#diagnostic-plots" class="nav-link" data-scroll-target="#diagnostic-plots"> <span class="header-section-number">3</span> Diagnostic plots</a></li>
<li><a href="#model-comparison" class="nav-link" data-scroll-target="#model-comparison"> <span class="header-section-number">4</span> Model comparison</a></li>
<li><a href="#confidence-intervals-and-prediction-intervals" class="nav-link" data-scroll-target="#confidence-intervals-and-prediction-intervals"> <span class="header-section-number">5</span> Confidence intervals and prediction intervals</a>
<ul class="collapse">
<li><a href="#the-delta-method" class="nav-link" data-scroll-target="#the-delta-method"> <span class="header-section-number">5.1</span> The delta-method</a></li>
<li><a href="#parametric-bootstrap-2" class="nav-link" data-scroll-target="#parametric-bootstrap-2"> <span class="header-section-number">5.2</span> Parametric bootstrap</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jchiquet/MAP566/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content">
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Nonlinear Regression</h1>
<p class="subtitle lead">Lecture Notes</p>
</header>

<section id="preliminary" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="preliminary">Preliminary</h2>
<p>Only functions from <code>R</code>-base and stats (preloaded) are required plus packages from the <strong>tidyverse</strong> for data representation and manipulation. You could also try the package <strong>broom</strong> that standardizes the output of built-in R functions for statistical modelling</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/linear-regression-config_cc5488ab5cdf4ffbc9ed146720d3e30f">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The <code>faithful</code> data (provided by the <code>R</code> base package <strong>datasets</strong>) consist of the waiting time between eruptions and the duration of the eruption for the Old Faithful geyser in Yellowstone National Park, Wyoming, USA.</p>
<p>Let us see how these data look like.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-2_44950213454ce269b4a440a91862ca6b">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>faithful_plot <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  faithful <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting) <span class="sc">+</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">colour=</span><span class="st">"#993399"</span>) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Waiting time to next eruption (mn)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"duration of the eruption (mn)"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>faithful_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We aim to fit a model to this data that describes the relationship between duration and waiting time.</p>
<p>If we try to fit a fit a polynomial model, we can check that a polynomial of degree 4 is considered as the ``best polynomial model’’.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/faithful-poly4-fit_fc1482c4f0b66d835b682e1219867ccc">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>poly4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(waiting <span class="sc">~</span><span class="fu">poly</span>(eruptions, <span class="dv">4</span>), <span class="at">data =</span> faithful)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/faithful-poly4-plot_b2a83a25e3ceed73a4d85e2481718fe9">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>faithful_plot <span class="ot">&lt;-</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  faithful_plot <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">4</span>), <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour=</span><span class="st">"#339900"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Even if this model is the ``best’’ polynomial model, we may have serious doubts on the capabilities of the model to predict waiting times for durations outside of the observed range of durations.</p>
<p>Furthermore, parameters of the model, i.e.&nbsp;the polynomials’ coefficients, have no obvious physical interpretation. Using a polynomial model here, we are therefore not seeking to build a structural model <span class="math inline">f</span> that approximates a physical phenomenon, but merely seeking to rely the variability in the observations to the explanatory variables <span class="math inline">x</span>, <span class="math inline">x^2</span>, …</p>
<p>We therefore need to consider other types of models, <em>i)</em> that do not necessarily assume linear relationships between the response variable and the explanatory variables, <em>ii)</em> whose parameters have some physical interpretation.</p>
<p>A <em>logistic function</em> (or <em>logistic curve</em>) is a common “S” shape (sigmoid curve), with equation:</p>
<p><span class="math display">
f_1(x) = \frac{A}{1+{\rm exp}(-\gamma(x-\tau))}
</span></p>
<iframe src="http://shiny.webpopix.org/sia/nlm1/" style="border: none; width: 800px; height: 400px">
</iframe>
<p>Here, <span class="math inline">A</span> is the limiting value (when <span class="math inline">x \to \infty</span>), <span class="math inline">\gamma</span> measure the steepness of the curve and <span class="math inline">\tau</span> is the <span class="math inline">x</span>-value of the sigmoid’s midpoint.</p>
<p>This model is a nonlinear model in the sense that the regression function <span class="math inline">f_1</span> is a nonlinear function of the parameters.We can fit this model to our data using the <code>nls</code> function.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-4_9277d593bd39f331e6a804fc357d82d4">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nlm1 <span class="ot">&lt;-</span> <span class="fu">nls</span>(waiting <span class="sc">~</span>  A <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (eruptions <span class="sc">-</span>tau))), faithful, <span class="at">start =</span> <span class="fu">c</span>(<span class="at">A=</span><span class="dv">70</span>, <span class="at">gamma=</span><span class="dv">2</span>, <span class="at">tau=</span><span class="dv">1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nlm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Formula: waiting ~ A/(1 + exp(-gamma * (eruptions - tau)))

Parameters:
      Estimate Std. Error t value Pr(&gt;|t|)    
A      93.1097     4.5080  20.654  &lt; 2e-16 ***
gamma   0.6394     0.1022   6.254 1.57e-09 ***
tau     1.4623     0.1092  13.391  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.763 on 269 degrees of freedom

Number of iterations to convergence: 9 
Achieved convergence tolerance: 6.242e-06</code></pre>
</div>
</div>
<p>We will see in the next sections what these results are and how they are computed.</p>
<p>An extension of the logistic function assumes a minimum waiting time <span class="math inline">S</span> between eruptions:</p>
<p><span class="math display">
f_2(x) =  S + \frac{A-S}{1+{\rm exp}(-\gamma(x-\tau))}
</span></p>
<iframe src="http://shiny.webpopix.org/sia/nlm2/" style="border: none; width: 800px; height: 400px">
</iframe>
<p>We can again use <code>nls</code> to fit this nonlinear model to the data:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-6_0faaec02ddc7109a7010fc2f22db0f2b">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nlm2 <span class="ot">&lt;-</span> <span class="fu">nls</span>(waiting <span class="sc">~</span> (A<span class="sc">-</span>S) <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>gamma <span class="sc">*</span> (eruptions <span class="sc">-</span> tau)) ) <span class="sc">+</span> S, faithful, <span class="at">start =</span> <span class="fu">c</span>(<span class="at">A=</span><span class="dv">90</span>, <span class="at">gamma=</span><span class="dv">2</span>, <span class="at">tau=</span><span class="dv">2</span>, <span class="at">S=</span><span class="dv">50</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nlm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Formula: waiting ~ (A - S)/(1 + exp(-gamma * (eruptions - tau))) + S

Parameters:
      Estimate Std. Error t value Pr(&gt;|t|)    
A      82.4659     0.9973  82.689  &lt; 2e-16 ***
gamma   2.2539     0.4355   5.175 4.47e-07 ***
tau     3.0553     0.1107  27.610  &lt; 2e-16 ***
S      51.3221     1.8303  28.040  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.622 on 268 degrees of freedom

Number of iterations to convergence: 9 
Achieved convergence tolerance: 6.287e-06</code></pre>
</div>
</div>
<p>We can now compute and plot the waiting times predicted with these two fitted models</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-8_34ce1d1c916e76e73118d77bfd2a8354">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>faithful_plot <span class="ot">&lt;-</span> faithful_plot <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">method  =</span> <span class="st">"nls"</span>,  <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> A <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (x<span class="sc">-</span>tau))), </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="at">A=</span><span class="dv">70</span>, <span class="at">gamma=</span><span class="dv">2</span>, <span class="at">tau=</span><span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method  =</span> <span class="st">"nls"</span>,  <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#56B4E9"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> (A<span class="sc">-</span>S) <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>gamma <span class="sc">*</span> (x<span class="sc">-</span>tau)) ) <span class="sc">+</span> S, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">start=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">90</span>, <span class="at">gamma=</span><span class="dv">2</span>, <span class="at">tau=</span><span class="dv">2</span>, <span class="at">S=</span><span class="dv">50</span>))) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>faithful_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We will see in the next sections</p>
<ul>
<li>how to fit a nonlinear model to the data. We will use the model <span class="math inline">f_1</span> and show how to retrieve the results of <code>nlm1</code>.</li>
<li>how to evaluate the capability of the model to describe the observed data,</li>
<li>how to compare possible models,</li>
<li>how to compute confidence intervals and prediction intervals for predicted values.</li>
</ul>
</section>
<section id="fitting-a-nonlinear-model" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="fitting-a-nonlinear-model"><span class="header-section-number">2</span> Fitting a nonlinear model</h2>
<section id="estimation-of-the-parameters-of-the-model" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="estimation-of-the-parameters-of-the-model"><span class="header-section-number">2.1</span> Estimation of the parameters of the model</h3>
<section id="least-squares-estimation" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="least-squares-estimation"><span class="header-section-number">2.1.1</span> Least squares estimation</h4>
<p>In the model</p>
<p><span class="math display">y_j = f(x_j,\beta) + \varepsilon_j \quad ; \quad 1\leq j \leq n</span> The least squares (LS) estimator of <span class="math inline">\beta</span> minimizes the residual sum of squares (RSS)</p>
<p><span class="math display">
\hat{\beta} = \arg\min_{\beta}\sum_{j=1}^n (y_j - f(x_j,\beta))^2
</span></p>
<p>Here, there is no closed-form expression for <span class="math inline">\hat{\beta}</span>. An optimization procedure is then used for computing <span class="math inline">\hat{\beta}</span>.</p>
<p>We define the first model <span class="math inline">{\cal M}_1</span> as</p>
<p><span class="math display">y_j = f_1(x_j,\beta) + \varepsilon_j \quad ; \quad 1\leq j \leq n</span></p>
<p>where <span class="math inline">f_1</span> is the logistic function defined above and where <span class="math inline">\beta = (A,\gamma,\tau)</span>. In <code>R</code>,</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-10_d92060387c1460f7a5ca112e9a18c577">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>f_1  <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, x) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> beta[<span class="dv">1</span>]; gamma <span class="ot">&lt;-</span> beta[<span class="dv">2</span>]; tau <span class="ot">&lt;-</span> beta[<span class="dv">3</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (x<span class="sc">-</span>tau)))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us check that function <code>nls</code> computes the nonlinear least-squares estimates of the parameters of the (nonlinear) model, that is, solve the above optimization problem in <span class="math inline">\beta</span>. We first create a function that computes the residual sum of squares for a given vector of parameters <span class="math inline">\beta</span>, which will be the objective (or cost) function from the optimization point of view:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-12_b2b885d2050ea7949edec42c38ef9fc1">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rss_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, x, y) <span class="fu">sum</span>( (y <span class="sc">-</span> <span class="fu">f_1</span>(beta, x) )<span class="sc">^</span><span class="dv">2</span> ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then the LS estimate of <span class="math inline">\beta</span> can be computed using <code>nlm</code> (nonlinear minimization) which minimizes the residuals sum of squares using a Newton-type algorithm.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-14_28f6b3be9f4c9311ce794b327d9d5730">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>optim_nlm1 <span class="ot">&lt;-</span> <span class="fu">nlm</span>(rss_1, <span class="fu">c</span>(<span class="at">A =</span> <span class="dv">90</span>, <span class="at">gamma =</span> <span class="dv">2</span>, <span class="at">tau =</span> <span class="dv">2</span>), faithful<span class="sc">$</span>eruptions, faithful<span class="sc">$</span>waiting)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> <span class="fu">setNames</span>(optim_nlm1<span class="sc">$</span>estimate, <span class="fu">names</span>(<span class="fu">coef</span>(nlm1)))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>beta_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>         A      gamma        tau 
93.1100965  0.6393835  1.4622674 </code></pre>
</div>
</div>
<p>Assume now that the residual errors are random variables with mean 0 and variance <span class="math inline">\sigma^2</span></p>
<p><span class="math display">\mathbb{E}[\varepsilon_j] = 0 \quad, \quad \mathbb{E}[\varepsilon_j^2] = \sigma^2 \quad, \quad 1 \leq j \leq n</span></p>
<p>Then, following the approach for linear models, if <span class="math inline">\beta</span> is a vector of length <span class="math inline">p</span>, there are <span class="math inline">n-p</span> degrees of freedom,the residual error variance is defined as</p>
<p><span class="math display">
\hat{\sigma}^2 = \frac{1}{n-p} \sum_{j=1}^n \left( y_j - f(x_j,\hat{\beta})\right)^2
</span></p>
<p>and the so-called <em>residual standard error</em> is</p>
<p><span class="math display">
\hat{\sigma} = \sqrt{\hat{\sigma}^2}
</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-16_1ab7690a73f3c71ccb9c9f0a53088b06">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="fu">nrow</span>(faithful)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>p  <span class="ot">&lt;-</span> <span class="fu">length</span>(beta_hat)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> (n <span class="sc">-</span> p)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sigma_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rss_1</span>(beta_hat, faithful<span class="sc">$</span>eruptions, faithful<span class="sc">$</span>waiting)<span class="sc">/</span>df)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sigma_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 5.762887</code></pre>
</div>
</div>
</section>
<section id="maximum-likelihood-estimation" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="maximum-likelihood-estimation"><span class="header-section-number">2.1.2</span> Maximum likelihood estimation</h4>
<p>Let <span class="math inline">\varepsilon_j=\sigma \varepsilon_j</span> where <span class="math inline">(\varepsilon_j)</span> is a sequence of independent and normally distributed random variables with mean 0 and variance <span class="math inline">1</span></p>
<p><span class="math display">
\varepsilon_j \sim^{\mathrm{iid}}  \mathcal{N}(0, 1).
</span></p>
<p>We can then rewrite the model as follows:</p>
<p><span class="math display">y_j = f(x_j,\beta) + \sigma \varepsilon_j \quad ; \quad 1\leq j \leq n</span></p>
<p>The maximum likelihood (ML) estimator of <span class="math inline">\beta</span> coincides with the least squares estimator</p>
<p><span class="math display">\begin{aligned}
\hat{\beta} &amp;=  \arg\min_{\beta}\sum_{j=1}^n \left(y_j - f(x_j,\beta)\right)^2
\end{aligned}</span></p>
<p>and the ML estimators of <span class="math inline">\sigma^2</span> and <span class="math inline">\sigma</span> are</p>
<p><span class="math display">
\hat{\sigma}^2_{\rm ml} = \frac{1}{n} \sum_{j=1}^n \left(y_j - f(x_j,\hat{\beta})\right)^2, \qquad \hat{\sigma}_{\rm ml} = \sqrt{\hat{\sigma}^2_{\rm ml}}
</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-18_332b5d47e612a834836e48aadc574b49">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sigma_hat_ML <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rss_1</span>(beta_hat, faithful<span class="sc">$</span>eruptions, faithful<span class="sc">$</span>waiting) <span class="sc">/</span> n)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sigma_hat_ML</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 5.731018</code></pre>
</div>
</div>
</section>
</section>
<section id="standard-errors-of-the-parameter-estimates" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="standard-errors-of-the-parameter-estimates"><span class="header-section-number">2.2</span> Standard errors of the parameter estimates</h3>
<p>Several methods exist for estimating the standard errors of the parameter estimates. In particular, the <code>nls</code> function uses a linear approximation of the model, but a likelihood approach or a parametric bootstrap may also provide estimates of these s.e.</p>
<section id="linearization-approach" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="linearization-approach"><span class="header-section-number">2.2.1</span> Linearization approach</h4>
<p>An <code>nls</code> object has methods for several generic functions, including <code>vcov</code> which computes the variance-covariance matrix of the estimated parameters <span class="math inline">\hat{\beta}</span>.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-20_0982e106264b66d72314f846c005a62e">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(nlm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>               A        gamma          tau
A     20.3217803 -0.451414983  0.432032790
gamma -0.4514150  0.010452942 -0.008769223
tau    0.4320328 -0.008769223  0.011923452</code></pre>
</div>
</div>
<p>The standard errors of the estimates are then the square roots of the diagonal elements of this matrix</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-22_a99e21c01a3e6c3ad54fedf1b4bc1451">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(nlm1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>        A     gamma       tau 
4.5079685 0.1022396 0.1091946 </code></pre>
</div>
</div>
<p>The <code>nls</code> function linearizes the model for computing this variance-covariance matrix. Indeed, for any <span class="math inline">\beta</span> ``close’’ to <span class="math inline">\hat{\beta}</span>,</p>
<p><span class="math display">
f(x_j , \beta) \simeq f(x_j , \hat{\beta}) + \nabla f(x_j , \hat{\beta})(\beta - \hat{\beta})
</span></p>
<p>where <span class="math inline">\nabla f(x_j , {\beta})</span> is the gradient of <span class="math inline">f(x_j , {\beta})</span>, i.e.&nbsp;the row vector of the first derivatives of <span class="math inline">f(x_j ,{\beta})</span> with respect to the <span class="math inline">d</span> components of <span class="math inline">\beta</span>. Setting <span class="math inline">z_j=y_j-f(x_j , \hat{\beta}) + \nabla f(x_j , \hat{\beta}) \hat{\beta}</span> and <span class="math inline">g_j=\nabla f(x_j , \hat{\beta}))</span>, the original model can be approximated by the linear model</p>
<p><span class="math display">
z_j = g_j \ \beta + \varepsilon_j.
</span></p>
<p>Writing this model in the matrix form <span class="math inline">z=G\, \beta + \varepsilon</span> where <span class="math inline">g_j</span> is the <span class="math inline">j</span>th row of matrix <span class="math inline">G</span>, we can check that the LS estimator of <span class="math inline">\beta</span> for this model is the LS estimator of the original model <span class="math inline">\hat{\beta}</span></p>
<div id="prp-linearization" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (Equivalence of the two LS estimate) </strong></span>The LS estimator of the linearized model is equivalent to the LS estimator of the original model:</p>
<p><span class="math display">
\begin{aligned}
\hat{\beta} &amp;=  \arg\min{\beta}\sum_{j=1}^n(y_j - f(x_j,\beta))^2 \\
&amp; =  \arg\min{\beta}\sum_{j=1}^n(z_j - g_j\beta)^2 \\
\end{aligned}
</span></p>
</div>
<div class="Proof">
<p>Let <span class="math inline">\tilde{\beta}</span> be the LS estimator of the linearized model. Then,</p>
<p><span class="math display">\begin{aligned}
\tilde{\beta} &amp;=  \arg\min{\beta} \, \left\|z - G\beta \right\|^2 \\
&amp;= (G^\prime G)^{-1}G^\prime z \\
&amp;= (G^\prime G)^{-1}G^\prime (y - f(x,\hat\beta) + G\hat\beta) \\
&amp;= \hat\beta + (G^\prime G)^{-1}\nabla f(x,\hat\beta) (y - f(x,\hat\beta) ) \\
\end{aligned}</span></p>
<p>By definition, <span class="math inline">\hat\beta</span> minimizes <span class="math inline">U(\beta) = \| y -f(x,\beta) \|^2</span>. Then,</p>
<p><span class="math display">
\nabla U(\hat\beta) = -2\nabla f(x,\hat\beta) (y - f(x,\hat\beta) )= 0
</span></p>
<p>Thus, <span class="math inline">\tilde\beta=\hat\beta</span> <span class="math inline">\Box</span>.</p>
</div>
<p>Let us check this property numerically:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-24_78c0ffdb7cf2ecf413908305ed571cd7">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hx <span class="ot">&lt;-</span> <span class="fu">deriv</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr    =</span> y <span class="sc">~</span> A <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (x <span class="sc">-</span> tau))), </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">namevec =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"gamma"</span>, <span class="st">"tau"</span>), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">function.arg =</span> <span class="cf">function</span>(A, gamma, tau, x) { }</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>fr <span class="ot">&lt;-</span> <span class="fu">hx</span>(beta_hat[<span class="dv">1</span>], beta_hat[<span class="dv">2</span>], beta_hat[<span class="dv">3</span>], faithful<span class="sc">$</span>eruptions)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>G  <span class="ot">&lt;-</span> <span class="fu">attr</span>(fr, <span class="st">"gradient"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>z  <span class="ot">&lt;-</span> faithful<span class="sc">$</span>waiting <span class="sc">-</span> <span class="fu">f_1</span>(beta_hat, faithful<span class="sc">$</span>eruptions) <span class="sc">+</span> G <span class="sc">%*%</span> beta_hat</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(<span class="fu">crossprod</span>(G)) <span class="sc">%*%</span> <span class="fu">crossprod</span>(G,z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>           [,1]
A     93.110121
gamma  0.639383
tau    1.462268</code></pre>
</div>
</div>
<p>Since <span class="math inline">\hat{\beta} =(G^\prime G)^{-1}G^\prime z</span>, the variance-covariance of <span class="math inline">\hat\beta</span> can be approximated by</p>
<p><span class="math display">\mathbb{V}_{\rm lin}(\hat\beta) = \hat\sigma^2 (G^\prime G)^{-1} </span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-26_89e78e090600cbde251fe7b347610d52">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>V_lin <span class="ot">&lt;-</span> sigma_hat<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">solve</span>(<span class="fu">t</span>(G)<span class="sc">%*%</span>G)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>V_lin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>               A        gamma          tau
A     20.3230488 -0.451427057  0.432076372
gamma -0.4514271  0.010452837 -0.008769862
tau    0.4320764 -0.008769862  0.011924743</code></pre>
</div>
</div>
<p>and we can derive standard errors <span class="math inline">({\rm se}_{\rm lin}(\hat{\beta}_k), 1 \leq k \leq p)</span> for the parameter estimates,</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-28_db007728bd1505ad074678d323edfa64">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>se_lin <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(V_lin))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>se_lin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>        A     gamma       tau 
4.5081092 0.1022391 0.1092005 </code></pre>
</div>
</div>
</section>
<section id="maximum-likelihood-approach" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="maximum-likelihood-approach"><span class="header-section-number">2.2.2</span> Maximum likelihood approach</h4>
<p>Let <span class="math inline">I_y(\hat{\beta})</span> be the observed Fisher information matrix at <span class="math inline">\hat{\beta}</span>:</p>
<p><span class="math display">
\begin{aligned}
I_y({\hat\beta}) &amp;= - \frac{\partial^2}{\partial \beta \partial \beta^\prime} \log \ell(\hat{\beta},\hat{\sigma}^2) \\
&amp;= \frac{1}{2\hat\sigma^2}\frac{\partial^2}{\partial \beta \partial \beta^\prime} \left(\sum_{j=1}^n(y_j - f(x_j,\hat\beta))^2 \right).
\end{aligned}
</span></p>
<p>Then, the Central Limit Theorem states that the variance of <span class="math inline">\hat{\beta}</span> can be approximated by the inverse of <span class="math inline">I_y(\hat{\beta})</span>:</p>
<p><span class="math display">\mathbb{V}_{\rm ml}(\hat{\beta}) = I_y(\hat{\beta})^{-1}. </span></p>
<p>Function <code>nlm</code> can return the Hessian of the function <code>rss_1</code> to minimize, i.e.&nbsp;the matrix of the second derivatives <span class="math inline">\partial^2/\partial \beta \partial \beta^\prime \sum_{j=1}^n(y_j - f(x_j,\hat\beta))^2</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-30_d4ed0e6234429fdd9c457e78b1726f96">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>optim_nlm1 <span class="ot">&lt;-</span> <span class="fu">nlm</span>(rss_1, <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">2</span>, <span class="dv">2</span>), faithful<span class="sc">$</span>eruptions, faithful<span class="sc">$</span>waiting, <span class="at">hessian =</span> <span class="st">"true"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>H <span class="ot">&lt;-</span> optim_nlm1<span class="sc">$</span>hessian</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>           [,1]      [,2]        [,3]
[1,]   324.8939   10848.5   -3794.477
[2,] 10848.4973  379318.3 -114782.339
[3,] -3794.4768 -114782.3   58845.489</code></pre>
</div>
</div>
<p>We then derive the FIM and the variance <span class="math inline">\mathbb{V}_{\rm ml}(\hat{\beta})</span>: ::: {.cell hash=‘map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-32_9960d090e32a447dba7855f3df6146f8’}</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>V_ml <span class="ot">&lt;-</span> <span class="fu">solve</span>(H<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>sigma_hat_ML<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>V_ml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>           [,1]         [,2]         [,3]
[1,] 17.4344838 -0.386666087  0.369991073
[2,] -0.3866661  0.008998208 -0.007381367
[3,]  0.3699911 -0.007381367  0.010576191</code></pre>
</div>
<p>::: and</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-34_a33bea2631d5542032ba219f67d594d1">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>se_ml <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(V_ml))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>se_ml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 4.17546210 0.09485888 0.10284061</code></pre>
</div>
</div>
<!-- ::: {.remark} -->
<!-- The Hessian of $\sum_{j=1}^n (y_j - f(x_j,\hat\beta))^2$ can be computed as a function of the first and second derivatives of $f$:  -->
<!-- $$ -->
<!--  \frac{\partial^2}{\partial \beta \partial \beta^\prime} \left(\sum_{j=1}^n(y_j - f(x_j,\hat\beta))^2 \right) = 2 \sum_{j=1}^n \left(  -->
<!-- \left(\frac{\partial}{\partial \beta}f(x_j,\hat\beta)\right)\left(\frac{\partial}{\partial \beta}f(x_j,\hat\beta)\right)^\prime - \frac{\partial^2}{\partial \beta \partial \beta^\prime}f(x_j,\hat\beta)y_j -->
<!-- \right) -->
<!-- $$ -->
<!-- ```{r} -->
<!-- hx <- deriv3(y ~ A / (1 + exp(-gamma*(x-tau))), c("A", "gamma", "tau"), -->
<!--              function(A, gamma, tau, x){} )  -->
<!-- fr <- hx(beta_hat[1], beta_hat[2] ,beta_hat[3], faithful$waiting) -->
<!-- gr <- attr(fr, "gradient") -->
<!-- hr <- attr(fr, "hessian") -->
<!-- H2 <- matrix(nrow = p, ncol = p) -->
<!-- for (k in (1:p)) -->
<!--   H2[k,] <- -2 * colSums(hr[,,k]*(faithful$eruptions - fr)) + 2 * gr[,k] %*% gr -->
<!-- H2 -->
<!-- ``` -->
<!-- ::: -->
<p>Beside, using the fact that <span class="math inline">\mathbb{V}(\chi^2(k))=2k</span>, we can show that <span class="math inline">\mathbb{V}(\hat{\sigma}^2) \approx 2\sigma^4/n</span>. Then the standard error of <span class="math inline">\hat{\sigma}</span> is approximately <span class="math inline">\hat{\sigma}/\sqrt{2n}</span>.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-36_86333b87e943527a83bf90e0bffd7cf3">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sigma_hat<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.2470817</code></pre>
</div>
</div>
</section>
<section id="parametric-bootstrap" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="parametric-bootstrap"><span class="header-section-number">2.2.3</span> Parametric bootstrap</h4>
<p>If we were able to repeat the same experiment under the same conditions, we would observe <span class="math inline">y^{(1)} = (y^{(1)}_j, 1\leq j \leq n)</span> and we would compute <span class="math inline">\beta^{(1)}</span>, an estimate of <span class="math inline">\beta</span>. Then, if we could repeat this experiment <span class="math inline">L</span> times, we would get <span class="math inline">L</span> estimates <span class="math inline">\beta^{(1)}</span>, <span class="math inline">\beta^{(2)}</span>, , <span class="math inline">\beta^{(L)}</span> of <span class="math inline">\beta</span>. This sequence of estimates <span class="math inline">(\beta^{(\ell)}, 1 \leq \ell \leq L)</span> would be a sample of random variables distributed as <span class="math inline">\hat{\beta}</span> and could therefore be used for estimating this distribution.</p>
<p>When such replicates are not available, parametric bootstrap (or Monte-Carlo simulation) is a way to mimic the repetition of an experiment.</p>
<p>For <span class="math inline">\ell=1,2,\ldots, L</span>, we generate ``observations’’ <span class="math inline">(y^{(\ell)}_j, 1\leq j \leq n)</span> with the model of interest, the original explanatory variables <span class="math inline">(x_j, 1\leq j\leq n)</span> and using the estimated parameters <span class="math inline">\hat\theta=(\hat\beta,\hat{\sigma}^2)</span>:</p>
<p><span class="math display">
y^{(\ell)}_j = f(x_j,\hat{\beta}) + \hat{\sigma} \varepsilon^{(\ell)}_j \quad ; \quad 1\leq j \leq n
</span></p>
<p>where <span class="math inline">\varepsilon^{(\ell)}_j \sim^{\mathrm{iid}} \mathcal{N}(0,1)</span>. We also compute the LS /ML estimate of <span class="math inline">\beta</span>:</p>
<p><span class="math display">\hat\beta^{(\ell)} = \arg\min{\beta}\sum_{j=1}^n(y^{(\ell)}_j - f(x_j,\beta))^2</span></p>
<p>The variance-covariance matrix of <span class="math inline">\hat\beta</span> is then estimated by the empirical variance-covariance matrix of <span class="math inline">(\hat\beta^{(\ell)})</span>:</p>
<p><span class="math display"> \mathbb{V}_{\rm mc}(\hat{\beta}) = \frac{1}{L-1}\sum_{\ell=1}^L ( \hat\beta^{(\ell)} - \bar{\beta} )( \hat\beta^{(\ell)} - \bar{ \beta} )^\prime
</span></p>
<p>where <span class="math inline">\bar{ \beta} = 1/L \sum_{\ell=1}^L \hat\beta^{(\ell)}</span>.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-38_14b1bcd07a7ce01d28a7f3a8f0ba7d6f">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>y_hat_ref <span class="ot">&lt;-</span> <span class="fu">predict</span>(nlm1)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> <span class="fu">coef</span>(nlm1)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> faithful<span class="sc">$</span>eruptions</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>betas_boot <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span>L, <span class="cf">function</span>(b) {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  y_b <span class="ot">&lt;-</span> y_hat_ref <span class="sc">+</span> sigma_hat <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(y_hat_ref))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">suppressWarnings</span>(<span class="fu">nls</span>(y_b <span class="sc">~</span>  <span class="fu">f_1</span>(beta, x), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta =</span> beta_hat))))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> L) <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>V_mc <span class="ot">&lt;-</span> <span class="fu">cov</span>(betas_boot)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>V_mc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>           [,1]        [,2]        [,3]
[1,] 25.7994299 -0.47385292  0.69285875
[2,] -0.4738529  0.01018124 -0.01080512
[3,]  0.6928588 -0.01080512  0.02243910</code></pre>
</div>
</div>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-40_249e272abe2b1aa8f8b993b6179d0167">
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>se_mc <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(V_mc))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>se_mc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 5.0793139 0.1009021 0.1497969</code></pre>
</div>
</div>
<div class="remark proof">
<p><span class="proof-title"><em>Remark</em>.</span>It would be equivalent to directly compute the empirical standard deviation of each component of the sequence <span class="math inline">(\hat\beta^{(\ell)})</span>:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-42_14451409a8d4ed9f80c607d86cb32438">
<div class="sourceCode" id="cb40"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(betas_boot, <span class="dv">2</span>, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 5.0793139 0.1009021 0.1497969</code></pre>
</div>
</div>
</div>
<p>One of the main advantages of this method is that it doesn’t make any assumption on <span class="math inline">\hat\beta</span>, contrary to the maximum likelihood estimator which asymptotic distribution is known to be normal, with a known asymptotic variance. Then, this asymptotic distribution is used with a finite set of observations for approximating the distribution of the ML estimator, but without knowing how good this approximation is. On its part, the linearization approach makes use of an approximation of the structural model, without knowing how good this approximation is.</p>
<p>In this example, the ML estimator seems to underestimate the standard error of the estimates. On the other hand, results obtained with the linearization approach are very similar to those obtained by Monte Carlo simulation.</p>
</section>
</section>
<section id="statistical-tests-for-the-model-parameters" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="statistical-tests-for-the-model-parameters"><span class="header-section-number">2.3</span> Statistical tests for the model parameters</h3>
<p>The summary of model <code>nlm1</code> includes several informations about the model parameters:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-44_0bc1bdecc7f134c5739cff950b3bc070">
<div class="sourceCode" id="cb42"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nlm1)<span class="sc">$</span>coefficient</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>        Estimate Std. Error   t value     Pr(&gt;|t|)
A     93.1097358  4.5079685 20.654478 1.974771e-57
gamma  0.6393916  0.1022396  6.253853 1.567065e-09
tau    1.4622598  0.1091946 13.391324 1.110090e-31</code></pre>
</div>
</div>
<p>Let <span class="math inline">\beta = (\beta_k, 1\leq k \leq p)</span> be the <span class="math inline">p</span>-vector of parameters of the model. In the linearized model <span class="math inline">z=G\beta+e</span>,</p>
<p><span class="math inline">t_k = (\hat{\beta}_k - \beta_k)/{\rm se}(\hat{\beta}_k)</span> follows a <span class="math inline">t</span>-distribution with <span class="math inline">n-p</span> degrees of freedom. We can then perform a <span class="math inline">t</span>-test to test if <span class="math inline">\beta_k=0</span>.</p>
<p>The test statistics is <span class="math inline">t_{{\rm stat}, k} = {\hat{\beta}_k}/{{\rm se}(\hat{\beta}_k)}</span> and the <span class="math inline">p</span>-value for this test is</p>
<p><span class="math display">p_k = 2(1 - \mathbb{P}(T_{n-d} \leq |t_{{\rm stat}, k}| ) </span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-46_61205886b0ad0a8976930270dd6dace0">
<div class="sourceCode" id="cb44"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>t_stat  <span class="ot">&lt;-</span> beta_hat<span class="sc">/</span>se_lin</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t_stat), n<span class="sc">-</span>p))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(beta_hat, se_lin, t_stat, p_value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>      beta_hat se_lin  t_stat p_value
A      93.1097 4.5081 20.6538       0
gamma   0.6394 0.1022  6.2539       0
tau     1.4623 0.1092 13.3906       0</code></pre>
</div>
</div>
</section>
<section id="confidence-intervals-for-the-model-parameters" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="confidence-intervals-for-the-model-parameters"><span class="header-section-number">2.4</span> Confidence intervals for the model parameters</h3>
<section id="linearization-approach-1" class="level4" data-number="2.4.1">
<h4 data-number="2.4.1" class="anchored" data-anchor-id="linearization-approach-1"><span class="header-section-number">2.4.1</span> Linearization approach</h4>
<p>Using the linearized model <span class="math inline">z = G\beta + \varepsilon</span>, we can compute a confidence interval for each component of <span class="math inline">\beta</span> as we do with any linear model:</p>
<p><span class="math display">{\rm CI}_{{\rm lin}, 1-\alpha}(\beta_k) = [\hat{\beta}_k + qt_{\alpha/2, n-p}\ {\rm se}_{\rm lin}(\hat{\beta}_k) \ , \ \hat{\beta}_k + qt_{1-\alpha/2, n-p}\ {\rm se}_{\rm lin}(\hat{\beta}_k)]</span></p>
<p>where <span class="math inline">qt_{p,\nu}</span> is the quantile of order <span class="math inline">p</span> for a <span class="math inline">t</span>-distribution with <span class="math inline">\nu</span> degree of freedom.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-48_9f78c545990b405f89cb1cef801206cf">
<div class="sourceCode" id="cb46"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>level <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> level</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>CI_linearized <span class="ot">&lt;-</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="sc">+</span> <span class="fu">qt</span>(alpha<span class="sc">/</span><span class="dv">2</span>, n<span class="sc">-</span>p) <span class="sc">*</span> se_lin,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="sc">+</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">-</span>p) <span class="sc">*</span> se_lin) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>),<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">+</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)))</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>CI_linearized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>           2.5%       97.5%
A     84.234071 101.9854003
gamma  0.438101   0.8406823
tau    1.247263   1.6772561</code></pre>
</div>
</div>
</section>
<section id="maximum-likelihood-approach-1" class="level4" data-number="2.4.2">
<h4 data-number="2.4.2" class="anchored" data-anchor-id="maximum-likelihood-approach-1"><span class="header-section-number">2.4.2</span> Maximum likelihood approach</h4>
<p>We can adopt the same approach with the ML estimate. Here, the standard errors <span class="math inline">({\rm se}_{\rm ml}(\hat{\beta}_k), 1 \leq k \leq p)</span> are derived from the asymptotic variance-covariance matrix of the parameter estimates <span class="math inline">V_{\rm ml}(\hat{\beta})</span> .</p>
<p><span class="math display">{\rm CI}_{{\rm ml},1-\alpha}(\beta_k) = [\hat{\beta}_k + qt_{\alpha/2, n-p}\ {\rm se}_{\rm ml}(\hat{\beta}_k) \ , \ \hat{\beta}_k + qt_{1-\alpha/2, n-p}\ {\rm se}_{\rm ml}(\hat{\beta}_k)]</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-50_24ac73ee3ac1c34bcc544363331687ee">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>CI_ML <span class="ot">&lt;-</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    beta_hat <span class="sc">+</span> <span class="fu">qt</span>(alpha<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">-</span>p) <span class="sc">*</span> se_ml,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    beta_hat <span class="sc">+</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">-</span>p) <span class="sc">*</span> se_ml) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>),<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">+</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>CI_ML</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>            2.5%       97.5%
A     84.8889942 101.3304773
gamma  0.4526314   0.8261519
tau    1.2597849   1.6647346</code></pre>
</div>
</div>
</section>
<section id="parametric-bootstrap-1" class="level4" data-number="2.4.3">
<h4 data-number="2.4.3" class="anchored" data-anchor-id="parametric-bootstrap-1"><span class="header-section-number">2.4.3</span> Parametric bootstrap</h4>
<p>The sequence <span class="math inline">(\hat{\beta}^{(\ell)}, 1 \leq \ell \leq L)</span> obtained by Monte Carlo simulation can be used for computing an empirical confidence interval:</p>
<p><span class="math display">{\rm CI}_{{\rm mc},1-\alpha}(\beta_k) = [\hat{\beta}_{k,\alpha/2} \ , \ \hat{\beta}_{k,1-\alpha/2} ]  </span> where, for any <span class="math inline">0 &lt; p &lt; 1</span>, <span class="math inline">\hat{\beta}_{k,p}</span> is the empirical quantile of order <span class="math inline">p</span> of <span class="math inline">(\hat{\beta}^{(\ell)}_k, 1 \leq \ell \leq L)</span>:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-52_c9c25167207ac969fac10f9957ac8938">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>CI_bootstrap <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="fu">as.matrix</span>(betas_boot), <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(alpha<span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>),<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">+</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>CI_bootstrap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>        2.5%       97.5%
1 86.6231669 106.9383472
2  0.4535852   0.8557305
3  1.3212753   1.9161431</code></pre>
</div>
</div>
<div class="remark proof">
<p><span class="proof-title"><em>Remark</em>.</span>These confidence intervals are slightly biased. We will use a linear model to explain where this bias comes from and show how to remove it.</p>
<p>Consider the linear model <span class="math inline">y = X\beta + \sigma\varepsilon</span>. A confidence interval of level <span class="math inline">1-\alpha</span> for <span class="math inline">\beta_k</span> is</p>
<p><span class="math display">{\rm CI}_{ 1-\alpha}(\beta_k) = [\hat{\beta}_k + qt_{\alpha/2, n-d}\ {\rm se}_(\hat{\beta}_k) \ , \ \hat{\beta}_k + qt_{1-\alpha/2, n-d}\ {\rm se}(\hat{\beta}_k)]</span></p>
<p>where <span class="math inline">{\rm se}(\hat{\beta}_k) = \hat\sigma^2 (X^\prime X)^{-1}_{kk}</span>.</p>
<p>On the other hand, for <span class="math inline">\ell=1,2,\ldots,L</span>,</p>
<p><span class="math display">y^{(\ell)} = X\hat{\beta} + \hat{\sigma} \varepsilon^{(\ell)} </span></p>
<p>and</p>
<p><span class="math display">\hat{\beta}^{(\ell)} = \hat\beta + \hat{\sigma}(X^\prime X)^{-1}X^\prime\varepsilon^{(\ell)}</span></p>
<p>Thus, conditionnally to the observations <span class="math inline">y</span>, i.e.&nbsp;conditionnally to <span class="math inline">\hat\beta</span>, <span class="math inline">\hat{\beta}_k^{(\ell)} \sim \mathcal{N}(\hat\beta_k \ , \ {\rm se}^2(\hat{\beta}_k))</span>. Then, the empirical quantile <span class="math inline">\hat{\beta}_{k,p}</span> is an estimator of the quantile of order <span class="math inline">p</span> of a normal distribution with mean <span class="math inline">\hat\beta_k</span> and variance <span class="math inline">{\rm se}^2(\hat{\beta}_k)</span>. In other words, the confidence interval <span class="math inline">{\rm CI}_{{\rm mc},1-\alpha}(\beta_k)</span> is an estimator of the interval <span class="math inline">[\hat{\beta}_k + q\mathcal{N}_{\alpha/2}\ {\rm se}_(\hat{\beta}_k) \ , \ \hat{\beta}_k + q\mathcal{N}_{1-\alpha/2}\ {\rm se}(\hat{\beta}_k)]</span>, where <span class="math inline">q\mathcal{N}_p</span> is the quantile of order <span class="math inline">p</span> for a <span class="math inline">\mathcal{N}(0,1)</span> distribution.</p>
<p>We see that these quantiles for a normal distribution should be tranformed into quantiles for a <span class="math inline">t</span>-ditribution with <span class="math inline">n-d</span> df.</p>
<p>An unbiased confidence interval for <span class="math inline">\beta_k</span> is therefore</p>
<p><span class="math display">{\rm CI}^\star_{{\rm mc},1-\alpha}(\beta_k) = [\hat{\beta}_k + \frac{qt_{\alpha/2, n-d}}{q\mathcal{N}_{\alpha/2}}(\hat{\beta}_{k,\alpha/2} - \hat{\beta}_k)\ , \  \hat{\beta}_k + \frac{qt_{1-\alpha/2, n-d}}{q\mathcal{N}_{1-\alpha/2}}(\hat{\beta}_{k,1-\alpha/2} - \hat{\beta}_k)]  </span></p>
<p>The same correction can be used for nonlinear models:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-54_ac764fb4e7dc15ba44500dc164188625">
<div class="sourceCode" id="cb52"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rq <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,df)<span class="sc">/</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="sc">+</span> rq<span class="sc">*</span>(CI_bootstrap <span class="sc">-</span> beta_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>        2.5%       97.5%
1 86.5938511 107.0008451
2  0.4527454   0.8567082
3  1.3206381   1.9181945</code></pre>
</div>
</div>
</div>
</section>
<section id="profile-likelihood" class="level4" data-number="2.4.4">
<h4 data-number="2.4.4" class="anchored" data-anchor-id="profile-likelihood"><span class="header-section-number">2.4.4</span> Profile likelihood</h4>
<p>Function <code>confint</code> uses the profile likelihood method for computing confidence intervals for parameters in a fitted model.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-56_bde701bbbc11889bf55cbe365bf87c77">
<div class="sourceCode" id="cb54"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>CI_profiled <span class="ot">&lt;-</span> <span class="fu">confint</span>(nlm1, <span class="at">level =</span> level)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>CI_profiled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>            2.5%       97.5%
A     87.1321726 105.5760368
gamma  0.4625255   0.8324095
tau    1.3109469   1.8569351</code></pre>
</div>
</div>
<p>Profile likelihood confidence intervals are based on the log-likelihood function.</p>
<p>Imagine that we want to compute a confidence interval for <span class="math inline">\beta_1</span>. The profile likelihood of <span class="math inline">\beta_1</span> is defined by</p>
<p><span class="math display">\ell_p(\beta_1) = \max_{\beta_2, \ldots, \beta_d}\ell(\beta_1, \beta_2, \ldots, \beta_d )</span></p>
<p><span class="math inline">\ell_p(\beta_1)</span> does no longer depend on <span class="math inline">\beta_2, \ldots, \beta_d</span> since it has been profiled out.</p>
<p>As an example, let us compute and display the profile log-likelihood of <span class="math inline">A</span> for model <code>nlm1</code></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-58_8a0db95ba94bf7b480f6ff3652b870ca">
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>f_1A <span class="ot">&lt;-</span> <span class="cf">function</span>(gamma,tau,x,A){ f <span class="ot">&lt;-</span>  A<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>gamma<span class="sc">*</span>(x<span class="sc">-</span>tau))) ; <span class="fu">return</span>(f)}</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>values_A <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">86</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>start    <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">gamma =</span> beta_hat[<span class="dv">2</span>], <span class="at">tau =</span> beta_hat[<span class="dv">3</span>])</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>logLik_A <span class="ot">&lt;-</span> <span class="fu">map</span>(values_A, <span class="sc">~</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nls</span>(waiting <span class="sc">~</span>  .x <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (eruptions <span class="sc">-</span> tau))), faithful, <span class="at">start =</span> start)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(logLik) <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-60_b3af73968c8998db0979177095095515">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">A =</span> values_A, <span class="at">logLik =</span> logLik_A) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> A, <span class="at">y =</span> logLik) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"blue"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> beta_hat[<span class="dv">1</span>], <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"longdash"</span>) <span class="sc">+</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">85</span>,<span class="dv">110</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="fu">round</span>(beta_hat[[<span class="dv">1</span>]],<span class="dv">2</span>)),<span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Consider the test of <span class="math inline">H_0: \beta_1 = \beta_1^\star</span> against <span class="math inline">H_1: \beta_1 \neq \beta_1^\star</span>. The likelihood ratio statistics is</p>
<p><span class="math display">LR_{\rm stat} = 2\left(\log(\ell(\hat\beta)) - \log(\ell_p(\beta_1^\star))\right)</span></p>
<p>where <span class="math inline">\hat\beta</span> is the value of <span class="math inline">\beta</span> that maximises the likelihood <span class="math inline">\ell(\beta)</span> under <span class="math inline">H_1</span>.</p>
<p>Under <span class="math inline">H_0</span>, <span class="math inline">LR_{\rm stat}</span> follows a <span class="math inline">\chi^2</span> distribution with 1 df. Then, the test is significant (i.e.&nbsp;we reject <span class="math inline">H_0</span>), if <span class="math inline">LR_{\rm stat}&gt; q\chi^2_{1,1-\alpha}</span> where <span class="math inline">q\chi^2_{1,1-\alpha}</span> is the quantile of order <span class="math inline">1-\alpha</span> for a <span class="math inline">\chi^2</span> distribution with 1 df.</p>
<p>A “profile likelihood confidence interval” of level <span class="math inline">1-\alpha</span> for <span class="math inline">\beta_1</span> consists of those values <span class="math inline">\beta_1^\star</span> for which the test is not significant.</p>
<!--
$$\begin{aligned}
1-\alpha &= {\mathbb P}_{H_0}\left(2\left(\log(\ell(\hat\beta)) - \log(\ell_p(\beta_1^\star))\right) < q\chi^2_{1,1-\alpha}\right) \\
 &= {\mathbb P}(\beta_{\alpha,1} \leq \beta \leq \beta_{\alpha,2})
\end{aligned}$$
-->
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-62_030f36c78885ac7f667635b44a05bf38">
<div class="sourceCode" id="cb58"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>qlevel <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(level,<span class="dv">1</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>lp_A <span class="ot">&lt;-</span> <span class="cf">function</span>(A, qlevel) {</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  nlm1_A <span class="ot">&lt;-</span> <span class="fu">nls</span>(waiting <span class="sc">~</span>  A <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span> gamma <span class="sc">*</span> (eruptions <span class="sc">-</span> tau))), faithful, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> <span class="fu">list</span>(<span class="at">gamma =</span> beta_hat[<span class="dv">2</span>], <span class="at">tau =</span> beta_hat[<span class="dv">3</span>]))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(nlm1) <span class="sc">-</span> <span class="fu">logLik</span>(nlm1_A) ) <span class="sc">-</span> qlevel) </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  res</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>c1_A <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_A, <span class="fu">c</span>(<span class="dv">80</span>,  beta_hat[<span class="dv">1</span>]), qlevel)<span class="sc">$</span>root</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>c2_A <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_A, <span class="fu">c</span>(beta_hat[<span class="dv">1</span>], <span class="dv">110</span>), qlevel)<span class="sc">$</span>root</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-64_b71c9673476ec862d9c2df65b11f3a26">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dlogLik_A <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="fu">as.numeric</span>(<span class="fu">logLik</span>(nlm1)) <span class="sc">-</span> logLik_A)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">A =</span> values_A, <span class="at">dlogLik =</span> dlogLik_A) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(values_A,dlogLik), <span class="at">size=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>qlevel, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"longdash"</span>) <span class="sc">+</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> c1_A, <span class="at">xend =</span> c1_A, <span class="at">y=</span><span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend=</span>qlevel),  <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"longdash"</span>)  <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> c2_A, <span class="at">xend =</span> c2_A, <span class="at">y=</span><span class="sc">-</span><span class="cn">Inf</span>, <span class="at">yend=</span>qlevel),  <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"longdash"</span>)  <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="fu">round</span>(qlevel,<span class="dv">2</span>)),<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">85</span>,<span class="dv">100</span>,<span class="at">by=</span><span class="dv">5</span>),<span class="fu">round</span>(c1_A,<span class="dv">1</span>),<span class="fu">round</span>(c2_A,<span class="dv">1</span>), <span class="dv">110</span>),<span class="st">"A"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now compute the profile likelihood confidence intervals for <span class="math inline">\gamma</span> and <span class="math inline">\tau</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-66_12873674b996beaa376327d44e965f36">
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>lp_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(gamma) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  nlm1_gamma <span class="ot">&lt;-</span> <span class="fu">nls</span>(waiting <span class="sc">~</span>  A<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>gamma<span class="sc">*</span>(eruptions<span class="sc">-</span>tau))), faithful,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A=</span>beta_hat[<span class="dv">1</span>],<span class="at">tau=</span>beta_hat[<span class="dv">3</span>]))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(nlm1) <span class="sc">-</span> <span class="fu">logLik</span>(nlm1_gamma) ) <span class="sc">-</span> qlevel)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>c1_gamma <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_gamma, <span class="at">lower =</span> <span class="fl">0.40</span>, <span class="at">upper =</span> beta_hat[<span class="dv">2</span>])<span class="sc">$</span>root</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>c2_gamma <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_gamma, <span class="at">lower =</span> beta_hat[<span class="dv">2</span>], <span class="at">upper=</span><span class="dv">1</span>)<span class="sc">$</span>root</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>lp_tau <span class="ot">&lt;-</span> <span class="cf">function</span>(tau) {</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  nlm1_tau <span class="ot">&lt;-</span> <span class="fu">nls</span>(waiting <span class="sc">~</span> A<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>gamma<span class="sc">*</span>(eruptions <span class="sc">-</span> tau))), faithful,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start=</span><span class="fu">list</span>(<span class="at">A=</span>beta_hat[<span class="dv">1</span>],<span class="at">gamma=</span>beta_hat[<span class="dv">2</span>]))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="dv">2</span><span class="sc">*</span>(<span class="fu">logLik</span>(nlm1) <span class="sc">-</span> <span class="fu">logLik</span>(nlm1_tau) ) <span class="sc">-</span> qlevel)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>c1_tau <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_tau, <span class="at">lower=</span><span class="fl">1.25</span>, <span class="at">upper=</span>beta_hat[<span class="dv">3</span>])<span class="sc">$</span>root</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>c2_tau <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_tau, <span class="at">lower=</span>beta_hat[<span class="dv">3</span>], <span class="at">upper=</span><span class="fl">2.25</span>)<span class="sc">$</span>root</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>CI_profiled_custom <span class="ot">&lt;-</span> </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="at">A =</span> <span class="fu">c</span>(c1_A , c2_A), <span class="at">gamma =</span> <span class="fu">c</span>(c1_gamma, c2_gamma), <span class="at">tau =</span> <span class="fu">c</span>(c1_tau, c2_tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>),<span class="fu">paste0</span>((<span class="dv">1</span><span class="sc">+</span>level)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)))</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>CI_profiled_custom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>            2.5%       97.5%
A     87.1523081 105.4511191
gamma  0.4636369   0.8310879
tau    1.3118040   1.8520538</code></pre>
</div>
</div>
<div class="remark proof">
<p><span class="proof-title"><em>Remark</em>.</span>The <code>confint</code> R function doesn’t use a <span class="math inline">\chi^2</span> distribution with 1 df for the LRT statistics <span class="math inline">LR_{\rm stat}</span> (which is theoretically the right asymptotic distribution).</p>
<p>On the contrary, the square root of <span class="math inline">LR_{\rm stat}</span> is assumed to follow a half <span class="math inline">t</span>-distribution with <span class="math inline">n-p</span> df. Then, the null hypothesis <span class="math inline">H_0</span> is rejected when <span class="math inline">LR_{\rm stat}&gt; qt_{1-\alpha/2,n-p}^2</span>.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-68_499b4edc278d1840e47421e3fca3dd1d">
<div class="sourceCode" id="cb62"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>qlevel <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,df)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>c1R_A <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_A, <span class="fu">c</span>(<span class="dv">80</span>,  beta_hat[<span class="dv">1</span>]), qlevel)<span class="sc">$</span>root</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>c2R_A <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(lp_A, <span class="fu">c</span>(beta_hat[<span class="dv">1</span>], <span class="dv">110</span>), qlevel)<span class="sc">$</span>root</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(c1R_A, c2R_A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1]  87.13229 105.53713</code></pre>
</div>
</div>
<p>The two tests - and then the two confidence intervals - are equivalent for large <span class="math inline">n</span> since a <span class="math inline">t</span>-distribution with <span class="math inline">n</span> df converges to a <span class="math inline">\mathcal{N}(0,1)</span> when <span class="math inline">n</span> goes to infinity. Then, for any <span class="math inline">0 &lt; p &lt; 1</span>,</p>
<p><span class="math display"> (qt_{p,n})^2 \xrightarrow{n\to \infty} q\chi^2_{p,1}</span></p>
</div>
</section>
</section>
</section>
<section id="diagnostic-plots" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="diagnostic-plots"><span class="header-section-number">3</span> Diagnostic plots</h2>
<p>Let us plot</p>
<ol type="1">
<li>the observed waiting times versus predicted waiting times,</li>
<li>the residuals versus eruption times,</li>
<li>the residuals versus predicted waiting times,</li>
<li>the distribution of the residuals</li>
</ol>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-70_e2275bbc9ec49e7a7595856b67d9ae57">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## unfortunately, no plotting function is defined for 'nls' object</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>residual_nlm1 <span class="ot">&lt;-</span> <span class="fu">resid</span>(nlm1)<span class="sc">/</span><span class="fu">sd</span>(<span class="fu">resid</span>(nlm1))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(nlm1), faithful<span class="sc">$</span>waiting)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, residual_nlm1)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(nlm1), residual_nlm1)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(residual_nlm1)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="fu">qnorm</span>(<span class="fl">0.25</span>), <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="fu">qnorm</span>(<span class="fl">0.75</span>), <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>On one hand, observations and predictions look well randomly distributed around the line <span class="math inline">y=x</span>. On the other hand, residual look well distributed around 0, with a constant variance. Furthermore, the distribution of the residuals appears to be symmetrical with quantiles close to those of a normal distribution</p>
<p>Then, based on these graphs, we don’t have any good reason for rejecting model <code>nlm1</code>… which doesn’t mean we should stay with this model as our final model!</p>
</section>
<section id="model-comparison" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="model-comparison"><span class="header-section-number">4</span> Model comparison</h2>
<p>We can produce the same the diagnostic plots with model <code>nlm2</code> and arrive at the same conclusion concerning this model.</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-72_1d941ff59616e4b33bed48bd0206a842">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>residual_nlm2 <span class="ot">&lt;-</span> <span class="fu">resid</span>(nlm2)<span class="sc">/</span><span class="fu">sd</span>(<span class="fu">resid</span>(nlm2))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(nlm2), faithful<span class="sc">$</span>waiting)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, residual_nlm2)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(nlm2), residual_nlm2)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(residual_nlm2)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="fu">qnorm</span>(<span class="fl">0.25</span>), <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="fu">qnorm</span>(<span class="fl">0.75</span>), <span class="at">b=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"magenta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="864"></p>
</div>
</div>
<p>Since <code>nlm1</code> and <code>nlm2</code> are two possible model for fitting our data, we need some criteria for comparing them. The statistical tests and the information criteria used for comparing linear models can also be used for comparing nonlinear models.</p>
<p>First, we can perform a ANOVA for testing model <code>nlm1</code> against model <code>nlm2</code> since these two models are nested (<code>nlm1</code> correponds to <code>nlm2</code> when <span class="math inline">S=0</span>)</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-74_e58e5ac19de169f6ce17cbe9b853924b">
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(nlm1, nlm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: waiting ~ A/(1 + exp(-gamma * (eruptions - tau)))
Model 2: waiting ~ (A - S)/(1 + exp(-gamma * (eruptions - tau))) + S
  Res.Df Res.Sum Sq Df Sum Sq F value    Pr(&gt;F)    
1    269     8933.7                                
2    268     8469.4  1  464.3  14.692 0.0001578 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Let <span class="math inline">RSS_1 = \|y- f_1(x,\hat\beta_1)\|^2</span> and <span class="math inline">RSS_2 = \|y- f_2(x,\hat\beta_2)\|^2</span> be the residual sums of squares under, respectively, <code>nlm1</code> and <code>nlm2</code>, and let <span class="math inline">d_1</span> and <span class="math inline">d_2</span> be lengths of vectors <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span>. Then,</p>
<p><span class="math display">
F_{\rm stat} = \frac{(RSS_1 - RSS_2)/(d_2-d_1)}{(RSS_2)/(n-d_2}
</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-76_4db888f60141dd1248bf886d56f61732">
<div class="sourceCode" id="cb68"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>RSS1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">resid</span>(nlm1)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>RSS2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">resid</span>(nlm2)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>p1   <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(nlm1))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>p2   <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(nlm2))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>F.stat <span class="ot">&lt;-</span> ( (RSS1<span class="sc">-</span>RSS2)<span class="sc">/</span>(p2<span class="sc">-</span>p1) ) <span class="sc">/</span> ( RSS2<span class="sc">/</span>(n<span class="sc">-</span>p2) )</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(RSS2, RSS1 <span class="sc">-</span> RSS2, F.stat, <span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(F.stat, p2<span class="sc">-</span>p1, n<span class="sc">-</span>p2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 8.469424e+03 4.642987e+02 1.469192e+01 1.577976e-04</code></pre>
</div>
</div>
<p><em>Remark:</em> since the model is nonlinear, we cannot decompose the residual sum of squares <span class="math inline">RSS_1</span> as we did with linear models. Indeed, here,</p>
<p><span class="math display">\|y- f_1(x,\hat\beta_1)\|^2 \neq \|f_1(x,\beta_1) - f_2(x,\hat\beta_2)\|^2 + \|y- f_2(x,\hat\beta_2)\|^2</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-78_e67bd9046639ac05461fc47768909f9b">
<div class="sourceCode" id="cb70"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(RSS1<span class="sc">-</span>RSS2, <span class="fu">sum</span>((<span class="fu">predict</span>(nlm1)<span class="sc">-</span><span class="fu">predict</span>(nlm2))<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 464.2987 520.3557</code></pre>
</div>
</div>
<p>Another way to test <code>nlm1</code> against <code>nlm2</code> consists in testing if <span class="math inline">S=0</span> in model <code>nlm2</code>:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-80_bd78af30a464908259c175a17f95a255">
<div class="sourceCode" id="cb72"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nlm2)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>       Estimate Std. Error   t value      Pr(&gt;|t|)
A     82.465891  0.9973074 82.688541 8.974188e-193
gamma  2.253936  0.4355265  5.175198  4.469534e-07
tau    3.055263  0.1106570 27.610217  2.420406e-80
S     51.322076  1.8302946 28.040336  1.110849e-81</code></pre>
</div>
</div>
<p>Even if both tests clearly prefer model <code>nlm2</code>, we can remark that the <span class="math inline">t</span>-test and the <span class="math inline">F</span>-test are not equivalent since the models are nonlinear.</p>
<p>Information criteria such as AIC and BIC also prefer model <code>nlm2</code>:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-82_5915f0c3f78d95a0c6ecd9bbc74cf2e2">
<div class="sourceCode" id="cb74"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">AIC</span>(nlm1, nlm2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>     df      AIC
nlm1  4 1729.668
nlm2  5 1717.152</code></pre>
</div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">BIC</span>(nlm1, nlm2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>     df      BIC
nlm1  4 1744.092
nlm2  5 1735.181</code></pre>
</div>
</div>
</section>
<section id="confidence-intervals-and-prediction-intervals" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="confidence-intervals-and-prediction-intervals"><span class="header-section-number">5</span> Confidence intervals and prediction intervals</h2>
<p>There is no ready-made functions to calculate confidence intervals for predicted values and prediction intervals for new data. We will see how to do it by implementing two different methods.</p>
<section id="the-delta-method" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="the-delta-method"><span class="header-section-number">5.1</span> The delta-method</h3>
<p>For a given value <span class="math inline">x_0</span> of the explanatory variable <span class="math inline">x</span>, we can use the model <span class="math inline">f</span> with the estimated parameter <span class="math inline">\hat{\beta}</span> and predict the response as <span class="math inline">f(x_0,\hat{\beta})</span>.</p>
<p>Since <span class="math inline">\hat{\beta}</span> is a random vector with variance-covariance matrix <span class="math inline">\mathbb{V}(\hat{\beta})</span>, <span class="math inline">f(x_0,\hat{\beta})</span> is also a random variable that can be approximated by a linear function of <span class="math inline">\hat{\beta}</span></p>
<p><span class="math display">
f(x_0 , \beta) \simeq f(x_0 , \hat{\beta}) + \nabla f(x_0 , \hat{\beta})(\beta - \hat{\beta})
</span></p>
<p>Then, the so-called <em>delta-method</em> consists in using this approximation for approximating the variance of <span class="math inline">f(x_0,\hat{\beta})</span> by</p>
<p><span class="math display">
\mathbb{V}(f(x_0,\hat{\beta})) \simeq \nabla f(x_0 , \hat{\beta}) \mathbb{V}(\hat{\beta}) \nabla f(x_0 , \hat{\beta})^\prime,
</span></p>
<p>and we can now use this approximation for computing a <span class="math inline">(1-\alpha)100\%</span> confidence interval for each prediction <span class="math inline">f(x_0,\beta)</span>:</p>
<p><span class="math display">{\rm CI}_{{\rm lin}, 1-\alpha}= [f(x_0,\hat{\beta}) + qt_{\alpha/2, n-p}\ {\rm s.e.}(f(x_0,\hat{\beta})) \ , \ f(x_0,\hat{\beta}) + qt_{1-\alpha/2, n-p}\ {\rm s.e.}(f(x_0,\hat{\beta}))]</span></p>
<p>where <span class="math inline">{\rm s.e.}(f(x_0,\hat{\beta}))</span> is the standard error of <span class="math inline">f(x_0,\hat{\beta})</span> defined as</p>
<p><span class="math display">
{\rm s.e.}(f(x_0,\hat{\beta})) = \sqrt{\nabla f(x_0 , \hat{\beta}) \mathbb{V}(\hat{\beta}) \nabla f(x_0 , \hat{\beta})^\prime}
</span></p>
<p>We can also compute a prediction interval for a future observation <span class="math display">y_0 = f(x_0,\beta) + \varepsilon_0</span></p>
<p>The prediction for <span class="math inline">y_0</span> is</p>
<p><span class="math display">\hat{y}_0 = f(x_0 , \hat{\beta}).</span></p>
<p>Then, the standard error for this prediction should take into account the uncertainty on <span class="math inline">f(x_0,\beta)</span> and the variability of the residual error <span class="math inline">e_0</span>:</p>
<p><span class="math display">
{\rm s.e.}(\hat{y}_0) = \sqrt{\nabla f(x_0 , \hat{\beta}) \mathbb{V}(\hat{\beta}) \nabla f(x_0 , \hat{\beta})^\prime + \sigma^2}
</span></p>
<p>Then,</p>
<p><span class="math display">{\rm CI}_{{\rm lin}, 1-\alpha}(y_0) = [f(x_0,\hat{\beta}) + qt_{\alpha/2, n-p}\ {\rm s.e.}(\hat{y}_0) \ , \ f(x_0,\hat{\beta}) + qt_{1-\alpha/2, n-p}\ {\rm s.e.}(\hat{y}_0)]</span></p>
<p>As an example, let us compute the variance of <span class="math inline">f_2(x_0, \hat{\beta}_2)</span> for <span class="math inline">x_0 = 1, 1.1, 1.2, \ldots, 5.9, 6</span>,</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-84_c99a1c106c6ed6a21dfe5cdeb018474c">
<div class="sourceCode" id="cb78"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>f_prime <span class="ot">&lt;-</span> <span class="fu">deriv</span>(y <span class="sc">~</span> (A<span class="sc">-</span>S)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>gamma<span class="sc">*</span>(x<span class="sc">-</span>tau))) <span class="sc">+</span> S, <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"gamma"</span>, <span class="st">"tau"</span>, <span class="st">"S"</span>), <span class="cf">function</span>(A, gamma, tau, S, x){} ) </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>x_new <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">&lt;-</span> <span class="fu">coef</span>(nlm2)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>f_new    <span class="ot">&lt;-</span> <span class="fu">f_prime</span>(beta_hat[<span class="dv">1</span>], beta_hat[<span class="dv">2</span>], beta_hat[<span class="dv">3</span>], beta_hat[<span class="dv">4</span>], x_new)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>grad_new <span class="ot">&lt;-</span> <span class="fu">attr</span>(f_new, <span class="st">"gradient"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>GS <span class="ot">&lt;-</span> <span class="fu">rowSums</span>((grad_new <span class="sc">%*%</span> <span class="fu">vcov</span>(nlm2)) <span class="sc">*</span> grad_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then derive a <span class="math inline">95\%</span> confidence interval for each <span class="math inline">f_2(x_0,\beta)</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-86_b85498af9d36a3b5dfd05f4dbfc30ea0">
<div class="sourceCode" id="cb79"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>delta_f <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(GS) <span class="sc">*</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,  n <span class="sc">-</span> <span class="fu">length</span>(beta_hat))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>df_delta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x_new, </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">f =</span> f_new, </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwr_conf =</span> f_new <span class="sc">-</span> delta_f, </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">upr_conf =</span> f_new <span class="sc">+</span> delta_f</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and for each <span class="math inline">y_0</span></p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-88_f2f447d912b26a2053aa58a67897b2c9">
<div class="sourceCode" id="cb80"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>delta_y    <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(GS <span class="sc">+</span> <span class="fu">sigma</span>(nlm2)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>,df)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df_delta[<span class="fu">c</span>(<span class="st">"lwr_pred"</span>,<span class="st">"upr_pred"</span>)] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(f_new <span class="sc">-</span> delta_y,f_new <span class="sc">+</span> delta_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now plot these two intervals together with the data:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-90_9a1352213235b2a5c9a49f1c14c4496e">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(faithful)  <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="at">data=</span>df_delta, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">ymin=</span>lwr_pred, <span class="at">ymax=</span>upr_pred), <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>df_delta, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">ymin=</span>lwr_conf, <span class="at">ymax=</span>upr_conf), <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span><span class="st">"#339900"</span>) <span class="sc">+</span>   <span class="fu">geom_line</span>(<span class="at">data=</span>df_delta, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">y=</span>f_new), <span class="at">colour=</span><span class="st">"#339900"</span>, <span class="at">size=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="parametric-bootstrap-2" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="parametric-bootstrap-2"><span class="header-section-number">5.2</span> Parametric bootstrap</h3>
<p>A we have already seen, parametric bootstrap consists in simulating <span class="math inline">L</span> replicates of the experiment, by drawing random observations with the fitted model, i.e.&nbsp;using the estimated parameters $ $. Then, for each replicate,</p>
<ol type="1">
<li>an estimate <span class="math inline">\hat{\beta}^{(\ell)}</span> of the vector of parameters <span class="math inline">\beta</span> is computed,</li>
<li>a prediction <span class="math inline">f(x_0,\hat{\beta}^{(\ell)})</span> is computed for each value of <span class="math inline">x_0</span>,</li>
<li>a new observation <span class="math inline">y_0^{(\ell)}</span> is randomly drawn for each value of <span class="math inline">x_0</span>.</li>
</ol>
<p>We can then use the empirical quantiles of <span class="math inline">f(x_0,\hat{\beta}^{(\ell)}, 1 \leq \ell \leq L)</span> and <span class="math inline">(y_0^{(\ell)}, 1 \leq \ell \leq L)</span> to compute a confidence interval for <span class="math inline">f_0=f(x_0,\beta)</span> and a prediction interval for <span class="math inline">y_0</span>.</p>
<p>Let <span class="math inline">f_{0,p}</span> and <span class="math inline">y_{0,p}</span> be the empirical quantiles of order <span class="math inline">p</span> of <span class="math inline">f(x_0,\hat{\beta}^{(\ell)}, 1 \leq \ell \leq L)</span> and <span class="math inline">(y_0^{(\ell)}, 1 \leq \ell \leq L)</span>, respectively. Instead of using the empirical intervals</p>
<p><span class="math display">\begin{aligned}
{\rm CI}_{{\rm mc},1-\alpha}(f_0) &amp;= [f_{0,\alpha/2} \ , \ f_{0,1-\alpha/2} ]  \\
{\rm CI}_{{\rm mc},1-\alpha}(y_0) &amp;= [y_{0,\alpha/2} \ , \ y_{0,1-\alpha/2} ]  
\end{aligned}</span></p>
<p>we can define the confidence and prediction intervals using the correction previously introduced for obtaining unbiased intervals in the case of a linear model:</p>
<p><span class="math display">\begin{aligned}
&amp; {\rm CI}^\star_{{\rm mc},1-\alpha}(f_0) = \\
&amp; [f(x_0,\hat{\beta}) + \frac{qt_{\alpha/2, n-d}}{q\mathcal{N}_{\alpha/2}}(f_{0,\alpha/2} - f(x_0,\hat{\beta}))\ , \  f(x_0,\hat{\beta}) + \frac{qt_{1-\alpha/2, n-d}}{q\mathcal{N}_{1-\alpha/2}}(f_{0,1-\alpha/2} - f(x_0,\hat{\beta}))]  \\
&amp; {\rm CI}^\star_{{\rm mc},1-\alpha}(y_0) = \\
&amp; [f(x_0,\hat{\beta}) + \frac{qt_{\alpha/2, n-d}}{q\mathcal{N}_{\alpha/2}}(y_{0,\alpha/2} - f(x_0,\hat{\beta}))\ , \  f(x_0,\hat{\beta}) + \frac{qt_{1-\alpha/2, n-d}}{q\mathcal{N}_{1-\alpha/2}}(y_{0,1-\alpha/2} - f(x_0,\hat{\beta}))]  
\end{aligned}</span></p>
<p>Let us compute these confidence and prediction interval bu boostraping for the <span class="math inline">f_2</span>:</p>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-92_cd610d2e7d3ef4f8e7d2c2be11c103cf">
<div class="sourceCode" id="cb82"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>f_hat <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, x){ beta[<span class="dv">4</span>] <span class="sc">+</span> (beta[<span class="dv">1</span>]<span class="sc">-</span>beta[<span class="dv">4</span>])<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>beta[<span class="dv">2</span>]<span class="sc">*</span>(x<span class="sc">-</span>beta[<span class="dv">3</span>]))) }</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>beta_hat  <span class="ot">&lt;-</span> <span class="fu">coef</span>(nlm2)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>y_hat_ref <span class="ot">&lt;-</span> <span class="fu">f_hat</span>(beta_hat, x)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>df_mc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">x =</span>x_new, <span class="at">f =</span> f_new)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="cf">function</span>(b) {</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  y_b <span class="ot">&lt;-</span> y_hat_ref <span class="sc">+</span> <span class="fu">sigma</span>(nlm2) <span class="sc">*</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  nlm2_b <span class="ot">&lt;-</span> <span class="fu">nls</span>(y_b <span class="sc">~</span> <span class="fu">f_hat</span>(beta, x), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta =</span> beta_hat))</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  f_b <span class="ot">&lt;-</span> <span class="fu">predict</span>(nlm2_b, <span class="at">newdata =</span> df_mc)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">f_hat =</span> f_b, <span class="at">y_hat =</span> f_b <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fu">sigma</span>(nlm2)))</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>df_mc[<span class="fu">c</span>(<span class="st">"lwr_conf"</span>,<span class="st">"upr_conf"</span>)] <span class="ot">&lt;-</span> </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(res, <span class="st">"f_hat"</span>) <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(rbind) <span class="sc">%&gt;%</span> </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, quantile, <span class="fu">c</span>(alpha<span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>df_mc[<span class="fu">c</span>(<span class="st">"lwr_pred"</span>,<span class="st">"upr_pred"</span>)] <span class="ot">&lt;-</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(res, <span class="st">"y_hat"</span>) <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(rbind) <span class="sc">%&gt;%</span> </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">2</span>, quantile, <span class="fu">c</span>(alpha<span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="do">## removing bias</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>df_mc[,(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)] <span class="ot">&lt;-</span> f_new <span class="sc">+</span> rq<span class="sc">*</span>(df_mc[,(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)] <span class="sc">-</span> f_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="map566-lecture-nonlinear-regression_cache/html/unnamed-chunk-94_159d83206cb8c9e0c9867a07f7dfef7a">
<p></p><details>
<summary>Show the code</summary><p></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(faithful)  <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting)) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="at">data=</span>df_mc, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">ymin=</span>lwr_pred, <span class="at">ymax=</span>upr_pred), <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data=</span>df_mc, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">ymin=</span>lwr_conf, <span class="at">ymax=</span>upr_conf), <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span><span class="st">"#339900"</span>) <span class="sc">+</span>   </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>df_mc, <span class="fu">aes</span>(<span class="at">x=</span>x_new, <span class="at">y=</span>f_new), <span class="at">colour=</span><span class="st">"#339900"</span>, <span class="at">size=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="map566-lecture-nonlinear-regression_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../docs/regression/map566-lecture-polynomial-regression.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Polynomial Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../docs/regression/map566-lab-polynomial-regression.html">
        <span class="nav-page-text">Polynomial Regression</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->


</body></html>